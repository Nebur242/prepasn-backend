{
  "Resources": {
    "{{STAGING_ALIAS_RESOURCE_NAME}}": {
      "Type": "AWS::Lambda::Alias",
      "Properties": {
        "FunctionName": {
          "Ref": "{{LAMBDA_FUNCTION_URL_LOGICAL_ID}}"
        },
        "FunctionVersion": "$LATEST",
        "Name": "{{STAGING_ALIAS_NAME}}"
      }
    },
    "{{STAGING_ALIAS_RESOURCE_URL}}": {
      "Type": "AWS::Lambda::Url",
      "Properties": {
        "AuthType": "NONE",
        "Qualifier": "{{STAGING_ALIAS_NAME}}",
        "TargetFunctionArn": {
          "Ref": "{{LAMBDA_FUNCTION_URL_LOGICAL_ID}}"
        }
      }
    },
    "{{STAGING_ALIAS_FN_PERMISSION_RESOURCE_URL}}": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "FunctionName": {
          "Ref": "{{STAGING_ALIAS_RESOURCE_URL}}"
        },
        "Action": "lambda:InvokeFunctionUrl",
        "Principal": "*",
        "FunctionUrlAuthType": "NONE"
      }
    },
    "{{CLOUDFRONT_DISTRIBUTION_RESOURCE_NAME}}": {
      "Type": "AWS::CloudFront::Distribution",
      "Properties": {
        "DistributionConfig": {
          "Aliases": [],
          "Origins": [
            {
              "Id": {
                "Ref": "{{STAGING_ALIAS_RESOURCE_URL}}"
              },
              "DomainName": {
                "Fn::Select": [
                  0,
                  {
                    "Fn::Split": [
                      "/",
                      {
                        "Fn::Select": [
                          1,
                          {
                            "Fn::Split": [
                              "://",
                              {
                                "Fn::GetAtt": [
                                  "{{STAGING_ALIAS_RESOURCE_URL}}",
                                  "FunctionUrl"
                                ]
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              "OriginPath": "",
              "CustomOriginConfig": {
                "HTTPPort": "80",
                "HTTPSPort": "443",
                "OriginProtocolPolicy": "https-only",
                "OriginSSLProtocols": ["TLSv1", "TLSv1.1", "TLSv1.2"]
              }
            }
          ],
          "DefaultCacheBehavior": {
            "TargetOriginId": {
              "Ref": "{{STAGING_ALIAS_RESOURCE_URL}}"
            },
            "ViewerProtocolPolicy": "redirect-to-https",
            "AllowedMethods": [
              "HEAD",
              "DELETE",
              "POST",
              "GET",
              "OPTIONS",
              "PUT",
              "PATCH"
            ],
            "CachedMethods": ["HEAD", "GET", "OPTIONS"],
            "ForwardedValues": {
              "QueryString": true,
              "Headers": [],
              "Cookies": {
                "Forward": "all"
              }
            }
          },
          "CustomErrorResponses": [],
          "Comment": "",
          "Logging": {
            "IncludeCookies": "false",
            "Bucket": "",
            "Prefix": ""
          },
          "PriceClass": "PriceClass_200",
          "Enabled": "true",
          "WebACLId": "",
          "HttpVersion": "http2"
        }
      }
    }
  },
  "Outputs": {
    "{{STAGING_ALIAS_RESOURCE_URL}}": {
      "Description": "Staging Lambda Function URL",
      "Value": {
        "Fn::GetAtt": ["{{STAGING_ALIAS_RESOURCE_URL}}", "FunctionUrl"]
      }
    },
    "{{CLOUDFRONT_DISTRIBUTION_RESOURCE_NAME}}": {
      "Description": "CloudFront distribution pointing to Staging",
      "Value": {
        "Fn::GetAtt": [
          "{{CLOUDFRONT_DISTRIBUTION_RESOURCE_NAME}}",
          "DomainName"
        ]
      }
    }
  }
}
